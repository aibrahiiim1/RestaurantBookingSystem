@model RestaurantSettingsViewModel
@{
    ViewData["Title"] = "Restaurant Settings";
}

<div class="settings-page">
    <!-- Page Header -->
    <div class="page-header">
        <div>
            <h1><i class="fas fa-cog"></i> Restaurant Settings</h1>
            <p class="subtitle">Configure your restaurant's information and booking preferences</p>
        </div>
        <div class="header-actions">
            <a asp-action="Dashboard" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
        </div>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">
            <i class="fas fa-check-circle"></i>
            <span>@TempData["Success"]</span>
        </div>
    }

    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger">
            <i class="fas fa-exclamation-circle"></i>
            <div>
                <strong>Please fix the following errors:</strong>
                @Html.ValidationSummary(false, "", new { @class = "validation-list" })
            </div>
        </div>
    }

    <form asp-action="RestaurantSettings" method="post" enctype="multipart/form-data" id="settingsForm">
        <div class="settings-grid">
            <!-- Basic Information -->
            <div class="settings-card">
                <div class="card-header">
                    <h2><i class="fas fa-info-circle"></i> Basic Information</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label asp-for="Name" class="form-label required">Restaurant Name</label>
                        <input asp-for="Name" class="form-control" placeholder="Enter restaurant name" />
                        <span asp-validation-for="Name" class="validation-error"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="Description" class="form-label">Description</label>
                        <textarea asp-for="Description" class="form-control" rows="4" 
                                  placeholder="Describe your restaurant, cuisine, ambiance..."></textarea>
                        <span asp-validation-for="Description" class="validation-error"></span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label asp-for="CuisineType" class="form-label required">Cuisine Type</label>
                            <select asp-for="CuisineType" class="form-control">
                                <option value="">Select cuisine type</option>
                                <option value="Italian">Italian</option>
                                <option value="Chinese">Chinese</option>
                                <option value="Japanese">Japanese</option>
                                <option value="Indian">Indian</option>
                                <option value="Mexican">Mexican</option>
                                <option value="French">French</option>
                                <option value="American">American</option>
                                <option value="Mediterranean">Mediterranean</option>
                                <option value="Thai">Thai</option>
                                <option value="Korean">Korean</option>
                                <option value="Middle Eastern">Middle Eastern</option>
                                <option value="Other">Other</option>
                            </select>
                            <span asp-validation-for="CuisineType" class="validation-error"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="PriceRange" class="form-label">Price Range</label>
                            <select asp-for="PriceRange" class="form-control">
                                <option value="1">$ - Budget</option>
                                <option value="2">$$ - Moderate</option>
                                <option value="3">$$$ - Upscale</option>
                                <option value="4">$$$$ - Fine Dining</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Information -->
            <div class="settings-card">
                <div class="card-header">
                    <h2><i class="fas fa-address-card"></i> Contact Information</h2>
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label asp-for="PhoneNumber" class="form-label required">Phone Number</label>
                            <input asp-for="PhoneNumber" type="tel" class="form-control" 
                                   placeholder="+1 (555) 123-4567" />
                            <span asp-validation-for="PhoneNumber" class="validation-error"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Email" class="form-label">Email Address</label>
                            <input asp-for="Email" type="email" class="form-control" 
                                   placeholder="contact@restaurant.com" />
                            <span asp-validation-for="Email" class="validation-error"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label asp-for="Website" class="form-label">Website URL</label>
                        <input asp-for="Website" type="url" class="form-control" 
                               placeholder="https://www.restaurant.com" />
                        <span asp-validation-for="Website" class="validation-error"></span>
                    </div>
                </div>
            </div>

            <!-- Address -->
            <div class="settings-card">
                <div class="card-header">
                    <h2><i class="fas fa-map-marker-alt"></i> Address</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label asp-for="AddressLine1" class="form-label required">Address Line 1</label>
                        <input asp-for="AddressLine1" class="form-control" 
                               placeholder="Street address" />
                        <span asp-validation-for="AddressLine1" class="validation-error"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="AddressLine2" class="form-label">Address Line 2</label>
                        <input asp-for="AddressLine2" class="form-control" 
                               placeholder="Suite, unit, building, floor (optional)" />
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label asp-for="City" class="form-label required">City</label>
                            <input asp-for="City" class="form-control" placeholder="City" />
                            <span asp-validation-for="City" class="validation-error"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Area" class="form-label required">State/Province</label>
                            <input asp-for="Area" class="form-control" placeholder="State/Province" />
                            <span asp-validation-for="Area" class="validation-error"></span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label asp-for="PostalCode" class="form-label required">Postal Code</label>
                            <input asp-for="PostalCode" class="form-control" placeholder="12345" />
                            <span asp-validation-for="PostalCode" class="validation-error"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Country" class="form-label required">Country</label>
                            <input asp-for="Country" class="form-control" placeholder="Country" />
                            <span asp-validation-for="Country" class="validation-error"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Booking Settings -->
            <div class="settings-card">
                <div class="card-header">
                    <h2><i class="fas fa-calendar-cog"></i> Booking Settings</h2>
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label asp-for="TotalSeatingCapacity" class="form-label required">Total Seating Capacity</label>
                            <input asp-for="TotalSeatingCapacity" type="number" class="form-control" 
                                   min="1" placeholder="100" />
                            <span asp-validation-for="TotalSeatingCapacity" class="validation-error"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="DefaultBookingDurationMinutes" class="form-label required">Default Booking Duration</label>
                            <select asp-for="DefaultBookingDurationMinutes" class="form-control">
                                <option value="60">60 minutes</option>
                                <option value="90">90 minutes</option>
                                <option value="120">120 minutes</option>
                                <option value="150">150 minutes</option>
                                <option value="180">180 minutes</option>
                            </select>
                            <span asp-validation-for="DefaultBookingDurationMinutes" class="validation-error"></span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label asp-for="MaxGuestsPerReservation" class="form-label required">Max Guests Per Reservation</label>
                            <input asp-for="MaxGuestsPerReservation" type="number" class="form-control" 
                                   min="1" placeholder="12" />
                            <span asp-validation-for="MaxGuestsPerReservation" class="validation-error"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="MinGuestsPerReservation" class="form-label required">Min Guests Per Reservation</label>
                            <input asp-for="MinGuestsPerReservation" type="number" class="form-control" 
                                   min="1" placeholder="1" />
                            <span asp-validation-for="MinGuestsPerReservation" class="validation-error"></span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label asp-for="MaxAdvanceBookingDays" class="form-label required">Max Advance Booking (Days)</label>
                            <input asp-for="MaxAdvanceBookingDays" type="number" class="form-control" 
                                   min="1" placeholder="90" />
                            <span asp-validation-for="MaxAdvanceBookingDays" class="validation-error"></span>
                            <small class="form-help">How far in advance customers can book</small>
                        </div>

                        <div class="form-group">
                            <label asp-for="CancellationPolicyHours" class="form-label required">Cancellation Policy (Hours)</label>
                            <input asp-for="CancellationPolicyHours" type="number" class="form-control" 
                                   min="0" placeholder="24" />
                            <span asp-validation-for="CancellationPolicyHours" class="validation-error"></span>
                            <small class="form-help">Minimum hours before booking to cancel</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input asp-for="AcceptsOnlineBookings" type="checkbox" id="acceptOnline" />
                            <label for="acceptOnline">
                                <strong>Accept Online Bookings</strong>
                                <span>Allow customers to book tables through the website</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input asp-for="RequiresEmailVerification" type="checkbox" id="requireEmail" />
                            <label for="requireEmail">
                                <strong>Require Email Verification</strong>
                                <span>Customers must verify email before booking</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Opening Hours -->
            <div class="settings-card wide">
                <div class="card-header">
                    <h2><i class="fas fa-clock"></i> Opening Hours</h2>
                </div>
                <div class="card-body">
                    <div class="hours-grid">
                        @for (int i = 0; i < 7; i++)
                        {
                            var day = ((DayOfWeek)i).ToString();
                            <div class="day-hours">
                                <div class="day-name">
                                    <input type="checkbox" id="day@(i)" checked />
                                    <label for="day@(i)">@day</label>
                                </div>
                                <div class="time-inputs">
                                    <input type="time" class="form-control-sm" value="11:00" />
                                    <span>to</span>
                                    <input type="time" class="form-control-sm" value="22:00" />
                                </div>
                            </div>
                        }
                    </div>
                    <small class="form-help">Uncheck days when the restaurant is closed</small>
                </div>
            </div>

            <!-- Features & Amenities -->
            <div class="settings-card">
                <div class="card-header">
                    <h2><i class="fas fa-star"></i> Features & Amenities</h2>
                </div>
                <div class="card-body">
                    <div class="features-grid">
                        <div class="feature-item">
                            <input type="checkbox" id="wifi" value="Free WiFi" />
                            <label for="wifi">
                                <i class="fas fa-wifi"></i>
                                <span>Free WiFi</span>
                            </label>
                        </div>
                        <div class="feature-item">
                            <input type="checkbox" id="parking" value="Parking Available" />
                            <label for="parking">
                                <i class="fas fa-parking"></i>
                                <span>Parking</span>
                            </label>
                        </div>
                        <div class="feature-item">
                            <input type="checkbox" id="outdoor" value="Outdoor Seating" />
                            <label for="outdoor">
                                <i class="fas fa-tree"></i>
                                <span>Outdoor Seating</span>
                            </label>
                        </div>
                        <div class="feature-item">
                            <input type="checkbox" id="wheelchair" value="Wheelchair Accessible" />
                            <label for="wheelchair">
                                <i class="fas fa-wheelchair"></i>
                                <span>Wheelchair Accessible</span>
                            </label>
                        </div>
                        <div class="feature-item">
                            <input type="checkbox" id="private" value="Private Dining" />
                            <label for="private">
                                <i class="fas fa-door-closed"></i>
                                <span>Private Dining</span>
                            </label>
                        </div>
                        <div class="feature-item">
                            <input type="checkbox" id="bar" value="Full Bar" />
                            <label for="bar">
                                <i class="fas fa-glass-martini"></i>
                                <span>Full Bar</span>
                            </label>
                        </div>
                        <div class="feature-item">
                            <input type="checkbox" id="kids" value="Kids Friendly" />
                            <label for="kids">
                                <i class="fas fa-child"></i>
                                <span>Kids Friendly</span>
                            </label>
                        </div>
                        <div class="feature-item">
                            <input type="checkbox" id="live" value="Live Music" />
                            <label for="live">
                                <i class="fas fa-music"></i>
                                <span>Live Music</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Restaurant Photos -->
            <div class="settings-card">
                <div class="card-header">
                    <h2><i class="fas fa-images"></i> Restaurant Photos</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">Upload Photos</label>
                        <div class="file-upload-area" id="fileUploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Drag and drop photos here or click to browse</p>
                            <input type="file" id="photoUpload" multiple accept="image/*" hidden />
                            <button type="button" class="btn btn-outline" onclick="document.getElementById('photoUpload').click()">
                                Choose Files
                            </button>
                        </div>
                    </div>
                    <div id="photoPreview" class="photo-preview"></div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="form-actions">
            <button type="button" class="btn btn-outline" onclick="window.history.back()">
                Cancel
            </button>
            <button type="submit" class="btn btn-primary btn-large">
                <i class="fas fa-save"></i> Save Settings
            </button>
        </div>
    </form>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        // Photo upload preview
        const photoUpload = document.getElementById('photoUpload');
        const photoPreview = document.getElementById('photoPreview');
        const fileUploadArea = document.getElementById('fileUploadArea');

        photoUpload.addEventListener('change', function(e) {
            handleFiles(e.target.files);
        });

        // Drag and drop
        fileUploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        });

        fileUploadArea.addEventListener('dragleave', function(e) {
            this.classList.remove('drag-over');
        });

        fileUploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            handleFiles(e.dataTransfer.files);
        });

        function handleFiles(files) {
            photoPreview.innerHTML = '';
            Array.from(files).forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const div = document.createElement('div');
                        div.className = 'photo-item';
                        div.innerHTML = `
                            <img src="${e.target.result}" alt="Preview">
                            <button type="button" class="btn-remove" onclick="this.parentElement.remove()">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                        photoPreview.appendChild(div);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // Form validation
        document.getElementById('settingsForm').addEventListener('submit', function(e) {
            const requiredFields = this.querySelectorAll('[required]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.classList.add('error');
                } else {
                    field.classList.remove('error');
                }
            });

            if (!isValid) {
                e.preventDefault();
                alert('Please fill in all required fields');
            }
        });
    </script>
}

<style>
.settings-page {
    padding: 2rem;
    background: #f5f7fa;
    min-height: calc(100vh - 80px);
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 2rem;
}

.page-header h1 {
    font-size: 2rem;
    color: var(--text-color);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.subtitle {
    color: var(--text-light);
    font-size: 1rem;
}

.alert {
    padding: 1rem 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.alert-success {
    background: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
}

.alert-danger {
    background: #f8d7da;
    border: 1px solid #f5c6cb;
    color: #721c24;
}

.settings-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 2rem;
    margin-bottom: 2rem;
}

.settings-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.settings-card.wide {
    grid-column: span 2;
}

.card-header {
    padding: 1.5rem;
    border-bottom: 1px solid #e9ecef;
}

.card-header h2 {
    font-size: 1.25rem;
    color: var(--text-color);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin: 0;
}

.card-header h2 i {
    color: var(--primary-color);
}

.card-body {
    padding: 2rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    font-weight: 600;
    color: var(--text-color);
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

.form-label.required::after {
    content: ' *';
    color: var(--error-color);
}

.form-control {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    font-size: 1rem;
    transition: var(--transition);
}

.form-control:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 4px rgba(218, 55, 67, 0.1);
}

.form-control.error {
    border-color: var(--error-color);
}

.form-control-sm {
    padding: 0.5rem 0.75rem;
    font-size: 0.9rem;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.form-help {
    display: block;
    color: var(--text-light);
    font-size: 0.8rem;
    margin-top: 0.25rem;
}

.validation-error {
    display: block;
    color: var(--error-color);
    font-size: 0.875rem;
    margin-top: 0.25rem;
}

.checkbox-group {
    display: flex;
    align-items: start;
    gap: 0.75rem;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
}

.checkbox-group input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
    margin-top: 2px;
}

.checkbox-group label {
    flex: 1;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.checkbox-group label strong {
    color: var(--text-color);
}

.checkbox-group label span {
    color: var(--text-light);
    font-size: 0.875rem;
}

/* Opening Hours */
.hours-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.day-hours {
    display: grid;
    grid-template-columns: 150px 1fr;
    gap: 1rem;
    align-items: center;
    padding: 0.75rem;
    background: #f8f9fa;
    border-radius: 8px;
}

.day-name {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.day-name input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.day-name label {
    font-weight: 600;
    color: var(--text-color);
    cursor: pointer;
}

.time-inputs {
    display: flex;
    align-items: center;
    gap: 1rem;
}

/* Features Grid */
.features-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

.feature-item {
    display: flex;
}

.feature-item input[type="checkbox"] {
    display: none;
}

.feature-item label {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: #f8f9fa;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    cursor: pointer;
    transition: var(--transition);
}

.feature-item input[type="checkbox"]:checked + label {
    background: rgba(218, 55, 67, 0.1);
    border-color: var(--primary-color);
}

.feature-item label i {
    font-size: 1.25rem;
    color: var(--primary-color);
}

/* File Upload */
.file-upload-area {
    border: 2px dashed #e9ecef;
    border-radius: 8px;
    padding: 3rem 2rem;
    text-align: center;
    background: #f8f9fa;
    transition: var(--transition);
    cursor: pointer;
}

.file-upload-area:hover,
.file-upload-area.drag-over {
    border-color: var(--primary-color);
    background: rgba(218, 55, 67, 0.05);
}

.file-upload-area i {
    font-size: 3rem;
    color: var(--primary-color);
    margin-bottom: 1rem;
}

.file-upload-area p {
    color: var(--text-light);
    margin-bottom: 1rem;
}

.photo-preview {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.photo-item {
    position: relative;
    aspect-ratio: 1;
    border-radius: 8px;
    overflow: hidden;
}

.photo-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.btn-remove {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    width: 32px;
    height: 32px;
    background: rgba(0,0,0,0.7);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.btn-remove:hover {
    background: var(--error-color);
}

/* Form Actions */
.form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    padding: 2rem;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.btn-large {
    padding: 1rem 2.5rem;
    font-size: 1.125rem;
}

@@media (max-width: 1200px) {
    .settings-grid {
        grid-template-columns: 1fr;
    }

    .settings-card.wide {
        grid-column: span 1;
    }
}

@@media (max-width: 768px) {
    .settings-page {
        padding: 1rem;
    }

    .page-header {
        flex-direction: column;
        gap: 1rem;
    }

    .form-row {
        grid-template-columns: 1fr;
    }

    .features-grid {
        grid-template-columns: 1fr;
    }

    .day-hours {
        grid-template-columns: 1fr;
    }

    .form-actions {
        flex-direction: column;
    }

    .btn-large {
        width: 100%;
    }
}
</style>
